
rule TrojanDownloader_Win32_ValleyRat_CF{
	meta:
		description = "TrojanDownloader:Win32/ValleyRat.CF,SIGNATURE_TYPE_PEHSTR_EXT,0a 00 0a 00 01 00 00 "
		
	strings :
		$a_01_0 = {69 00 6f 00 73 00 00 00 68 00 00 00 74 00 00 00 74 70 00 00 3a 2f 2f 00 77 00 00 00 7a 67 6c 00 2e 00 00 00 79 6a 67 00 6c 6a 00 00 73 68 00 00 67 00 00 00 6f 76 2e 00 63 6e 3a 00 31 00 00 00 33 00 00 00 35 38 30 00 2f 00 00 00 64 00 00 00 65 6d 00 00 6f 2f 76 00 32 00 00 00 70 6e 00 } //10
	condition:
		((#a_01_0  & 1)*10) >=10
 
}
rule TrojanDownloader_Win32_ValleyRat_CF_2{
	meta:
		description = "TrojanDownloader:Win32/ValleyRat.CF,SIGNATURE_TYPE_PEHSTR_EXT,14 00 14 00 14 00 00 "
		
	strings :
		$a_01_0 = {54 b8 b9 1a } //1
		$a_01_1 = {78 1f 20 7f } //1 ὸ缠
		$a_01_2 = {62 34 89 5e } //1
		$a_01_3 = {73 80 48 06 } //1
		$a_01_4 = {a5 f2 5c 70 } //1
		$a_01_5 = {6e 74 64 6c } //1 ntdl
		$a_01_6 = {cb 79 b5 0d } //1
		$a_01_7 = {c0 e9 18 15 } //1
		$a_01_8 = {cf 2c f4 4f } //1
		$a_01_9 = {1b 16 ac 14 } //1
		$a_01_10 = {b2 34 61 0f } //1
		$a_01_11 = {dc 87 83 0f } //1
		$a_01_12 = {da 50 2b 09 } //1
		$a_01_13 = {c8 84 3a 31 } //1
		$a_01_14 = {d7 7d 5e 78 } //1
		$a_01_15 = {01 95 53 41 } //1
		$a_01_16 = {9f 2d 40 26 } //1
		$a_01_17 = {34 26 52 33 } //1 4&R3
		$a_01_18 = {43 0f b6 4c 1a 04 4c 8b 83 a0 00 00 00 b8 21 00 f3 20 49 ff c2 f7 e9 c1 fa 08 8b c2 c1 e8 1f 03 d0 b8 67 66 66 66 69 d2 c5 07 00 00 2b ca f7 ef 80 c1 36 43 30 0c 08 c1 fa 02 8b cf 8b c2 c1 e8 1f 03 d0 8d 04 92 03 c0 2b c8 f7 d9 48 1b c0 ff c7 49 ff c1 4c 23 d0 81 ff 0e d0 07 00 } //10
		$a_01_19 = {48 63 42 20 48 63 4a 2c c7 44 24 20 57 73 32 5f 48 03 c8 c7 44 24 24 33 32 2e 64 66 c7 44 24 28 6c 6c 48 8d 44 4a 38 48 8d 4c 24 20 } //5
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1+(#a_01_6  & 1)*1+(#a_01_7  & 1)*1+(#a_01_8  & 1)*1+(#a_01_9  & 1)*1+(#a_01_10  & 1)*1+(#a_01_11  & 1)*1+(#a_01_12  & 1)*1+(#a_01_13  & 1)*1+(#a_01_14  & 1)*1+(#a_01_15  & 1)*1+(#a_01_16  & 1)*1+(#a_01_17  & 1)*1+(#a_01_18  & 1)*10+(#a_01_19  & 1)*5) >=20
 
}
rule TrojanDownloader_Win32_ValleyRat_CF_3{
	meta:
		description = "TrojanDownloader:Win32/ValleyRat.CF,SIGNATURE_TYPE_PEHSTR_EXT,32 00 32 00 39 00 00 "
		
	strings :
		$a_01_0 = {55 00 6e 00 54 00 68 00 72 00 65 00 61 00 74 00 } //1 UnThreat
		$a_01_1 = {4b 00 37 00 54 00 53 00 65 00 63 00 75 00 72 00 69 00 74 00 79 00 2e 00 65 00 78 00 65 00 } //1 K7TSecurity.exe
		$a_01_2 = {41 00 64 00 2d 00 77 00 61 00 74 00 63 00 68 00 2e 00 65 00 78 00 65 00 } //1 Ad-watch.exe
		$a_01_3 = {50 00 53 00 61 00 66 00 65 00 53 00 79 00 73 00 54 00 72 00 61 00 79 00 2e 00 65 00 78 00 65 00 } //1 PSafeSysTray.exe
		$a_01_4 = {42 00 69 00 74 00 44 00 65 00 66 00 65 00 6e 00 64 00 65 00 72 00 } //1 BitDefender
		$a_01_5 = {76 00 73 00 73 00 65 00 72 00 76 00 2e 00 65 00 78 00 65 00 } //1 vsserv.exe
		$a_01_6 = {72 00 65 00 6d 00 75 00 70 00 64 00 2e 00 65 00 78 00 65 00 } //1 remupd.exe
		$a_01_7 = {72 00 74 00 76 00 73 00 63 00 61 00 6e 00 2e 00 65 00 78 00 65 00 } //1 rtvscan.exe
		$a_01_8 = {61 00 73 00 68 00 44 00 69 00 73 00 70 00 2e 00 65 00 78 00 65 00 } //1 ashDisp.exe
		$a_01_9 = {61 00 76 00 63 00 65 00 6e 00 74 00 65 00 72 00 2e 00 65 00 78 00 65 00 } //1 avcenter.exe
		$a_01_10 = {54 00 4d 00 42 00 4d 00 53 00 52 00 56 00 2e 00 65 00 78 00 65 00 } //1 TMBMSRV.exe
		$a_01_11 = {6b 00 6e 00 73 00 64 00 74 00 72 00 61 00 79 00 2e 00 65 00 78 00 65 00 } //1 knsdtray.exe
		$a_01_12 = {65 00 67 00 75 00 69 00 2e 00 65 00 78 00 65 00 } //1 egui.exe
		$a_01_13 = {4d 00 63 00 73 00 68 00 69 00 65 00 6c 00 64 00 2e 00 65 00 78 00 65 00 } //1 Mcshield.exe
		$a_01_14 = {61 00 76 00 70 00 2e 00 65 00 78 00 65 00 } //1 avp.exe
		$a_01_15 = {46 00 2d 00 53 00 65 00 63 00 75 00 72 00 65 00 } //1 F-Secure
		$a_01_16 = {61 00 76 00 67 00 77 00 64 00 73 00 76 00 63 00 2e 00 65 00 78 00 65 00 } //1 avgwdsvc.exe
		$a_01_17 = {41 00 59 00 41 00 67 00 65 00 6e 00 74 00 2e 00 61 00 79 00 65 00 } //1 AYAgent.aye
		$a_01_18 = {56 00 33 00 53 00 76 00 63 00 2e 00 65 00 78 00 65 00 } //1 V3Svc.exe
		$a_01_19 = {61 00 63 00 73 00 2e 00 65 00 78 00 65 00 } //1 acs.exe
		$a_01_20 = {44 00 52 00 2e 00 57 00 45 00 42 00 } //1 DR.WEB
		$a_01_21 = {53 00 50 00 49 00 44 00 65 00 72 00 2e 00 65 00 78 00 65 00 } //1 SPIDer.exe
		$a_01_22 = {43 00 6f 00 6d 00 6f 00 64 00 6f 00 } //1 Comodo
		$a_01_23 = {63 00 66 00 70 00 2e 00 65 00 78 00 65 00 } //1 cfp.exe
		$a_01_24 = {6d 00 73 00 73 00 65 00 63 00 65 00 73 00 73 00 2e 00 65 00 78 00 65 00 } //1 mssecess.exe
		$a_01_25 = {51 00 55 00 48 00 4c 00 50 00 53 00 56 00 43 00 2e 00 45 00 58 00 45 00 } //1 QUHLPSVC.EXE
		$a_01_26 = {52 00 61 00 76 00 4d 00 6f 00 6e 00 44 00 2e 00 65 00 78 00 65 00 } //1 RavMonD.exe
		$a_01_27 = {4b 00 76 00 4d 00 6f 00 6e 00 58 00 50 00 2e 00 65 00 78 00 65 00 } //1 KvMonXP.exe
		$a_01_28 = {62 00 61 00 69 00 64 00 75 00 53 00 61 00 66 00 65 00 54 00 72 00 61 00 79 00 2e 00 65 00 78 00 65 00 } //1 baiduSafeTray.exe
		$a_01_29 = {42 00 61 00 69 00 64 00 75 00 53 00 64 00 2e 00 65 00 78 00 65 00 } //1 BaiduSd.exe
		$a_01_30 = {32 00 33 00 34 00 35 00 53 00 61 00 66 00 65 00 54 00 72 00 61 00 79 00 2e 00 65 00 78 00 65 00 } //1 2345SafeTray.exe
		$a_01_31 = {48 00 69 00 70 00 73 00 54 00 72 00 61 00 79 00 2e 00 65 00 78 00 65 00 } //1 HipsTray.exe
		$a_01_32 = {51 00 51 00 50 00 43 00 52 00 54 00 50 00 2e 00 65 00 78 00 65 00 } //1 QQPCRTP.exe
		$a_01_33 = {4b 00 53 00 61 00 66 00 65 00 54 00 72 00 61 00 79 00 2e 00 65 00 78 00 65 00 } //1 KSafeTray.exe
		$a_01_34 = {6b 00 78 00 65 00 74 00 72 00 61 00 79 00 2e 00 65 00 78 00 65 00 } //1 kxetray.exe
		$a_01_35 = {33 00 36 00 30 00 73 00 64 00 2e 00 65 00 78 00 65 00 } //1 360sd.exe
		$a_01_36 = {5a 00 68 00 75 00 44 00 6f 00 6e 00 67 00 46 00 61 00 6e 00 67 00 59 00 75 00 2e 00 65 00 78 00 65 00 } //1 ZhuDongFangYu.exe
		$a_01_37 = {33 00 36 00 30 00 74 00 72 00 61 00 79 00 2e 00 65 00 78 00 65 00 } //1 360tray.exe
		$a_01_38 = {33 00 36 00 30 00 53 00 61 00 66 00 65 00 2e 00 65 00 78 00 65 00 } //1 360Safe.exe
		$a_01_39 = {57 00 78 00 57 00 6f 00 72 00 6b 00 2e 00 65 00 78 00 65 00 } //1 WxWork.exe
		$a_01_40 = {57 00 65 00 43 00 68 00 61 00 74 00 2e 00 65 00 78 00 65 00 } //1 WeChat.exe
		$a_01_41 = {77 00 65 00 69 00 78 00 69 00 6e 00 2e 00 65 00 78 00 65 00 } //1 weixin.exe
		$a_01_42 = {54 00 65 00 6c 00 65 00 67 00 72 00 61 00 6d 00 2e 00 65 00 78 00 65 00 } //1 Telegram.exe
		$a_01_43 = {44 00 69 00 6e 00 67 00 54 00 61 00 6c 00 6b 00 2e 00 65 00 78 00 65 00 } //1 DingTalk.exe
		$a_01_44 = {44 00 69 00 6e 00 67 00 54 00 61 00 6c 00 6b 00 47 00 6f 00 76 00 2e 00 65 00 78 00 65 00 } //1 DingTalkGov.exe
		$a_01_45 = {41 00 70 00 61 00 74 00 65 00 44 00 4e 00 53 00 } //1 ApateDNS
		$a_01_46 = {4d 00 61 00 6c 00 77 00 61 00 72 00 65 00 62 00 79 00 74 00 65 00 73 00 } //1 Malwarebytes
		$a_01_47 = {54 00 43 00 50 00 45 00 79 00 65 00 } //1 TCPEye
		$a_01_48 = {54 00 61 00 73 00 6b 00 45 00 78 00 70 00 6c 00 6f 00 72 00 65 00 72 00 } //1 TaskExplorer
		$a_01_49 = {43 00 75 00 72 00 72 00 50 00 6f 00 72 00 74 00 73 00 } //1 CurrPorts
		$a_01_50 = {4d 00 65 00 74 00 61 00 73 00 63 00 61 00 6e 00 } //1 Metascan
		$a_01_51 = {57 00 69 00 72 00 65 00 73 00 68 00 61 00 72 00 6b 00 } //1 Wireshark
		$a_01_52 = {46 00 69 00 64 00 64 00 6c 00 65 00 72 00 } //1 Fiddler
		$a_01_53 = {43 00 61 00 70 00 73 00 61 00 } //1 Capsa
		$a_01_54 = {49 00 70 00 64 00 61 00 74 00 65 00 } //1 Ipdate
		$a_01_55 = {49 00 70 00 64 00 61 00 74 00 65 00 53 00 70 00 65 00 63 00 69 00 61 00 6c 00 } //1 IpdateSpecial
		$a_01_56 = {c7 45 a8 30 cc ff 56 b8 98 d3 00 00 66 89 45 ac c7 45 ae d0 11 b2 ae c7 45 b2 00 a0 c9 08 66 c7 45 b6 fa 49 4c 89 74 24 70 } //5
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1+(#a_01_6  & 1)*1+(#a_01_7  & 1)*1+(#a_01_8  & 1)*1+(#a_01_9  & 1)*1+(#a_01_10  & 1)*1+(#a_01_11  & 1)*1+(#a_01_12  & 1)*1+(#a_01_13  & 1)*1+(#a_01_14  & 1)*1+(#a_01_15  & 1)*1+(#a_01_16  & 1)*1+(#a_01_17  & 1)*1+(#a_01_18  & 1)*1+(#a_01_19  & 1)*1+(#a_01_20  & 1)*1+(#a_01_21  & 1)*1+(#a_01_22  & 1)*1+(#a_01_23  & 1)*1+(#a_01_24  & 1)*1+(#a_01_25  & 1)*1+(#a_01_26  & 1)*1+(#a_01_27  & 1)*1+(#a_01_28  & 1)*1+(#a_01_29  & 1)*1+(#a_01_30  & 1)*1+(#a_01_31  & 1)*1+(#a_01_32  & 1)*1+(#a_01_33  & 1)*1+(#a_01_34  & 1)*1+(#a_01_35  & 1)*1+(#a_01_36  & 1)*1+(#a_01_37  & 1)*1+(#a_01_38  & 1)*1+(#a_01_39  & 1)*1+(#a_01_40  & 1)*1+(#a_01_41  & 1)*1+(#a_01_42  & 1)*1+(#a_01_43  & 1)*1+(#a_01_44  & 1)*1+(#a_01_45  & 1)*1+(#a_01_46  & 1)*1+(#a_01_47  & 1)*1+(#a_01_48  & 1)*1+(#a_01_49  & 1)*1+(#a_01_50  & 1)*1+(#a_01_51  & 1)*1+(#a_01_52  & 1)*1+(#a_01_53  & 1)*1+(#a_01_54  & 1)*1+(#a_01_55  & 1)*1+(#a_01_56  & 1)*5) >=50
 
}