
rule TrojanDropper_O97M_Obfuse_ABA_MTB{
	meta:
		description = "TrojanDropper:O97M/Obfuse.ABA!MTB,SIGNATURE_TYPE_MACROHSTR_EXT,04 00 04 00 04 00 00 "
		
	strings :
		$a_01_0 = {69 6e 69 28 29 73 65 74 66 73 6f 3d 63 72 65 61 74 65 6f 62 6a 65 63 74 28 22 73 63 72 69 22 26 22 70 74 69 6e 67 2e 66 22 26 22 69 6c 65 73 79 73 74 22 26 22 65 6d 6f 62 6a 65 63 74 22 29 73 33 32 3d 22 73 79 73 74 22 64 69 6d 76 28 29 61 73 73 74 72 69 6e 67 70 73 3d 22 64 66 64 68 67 68 72 65 76 68 6a 76 63 66 65 6b 6c 67 62 6e 76 31 38 6d 6d 37 68 64 66 67 68 22 } //1 ini()setfso=createobject("scri"&"pting.f"&"ilesyst"&"emobject")s32="syst"dimv()asstringps="dfdhghrevhjvcfeklgbnv18mm7hdfgh"
		$a_01_1 = {73 72 63 29 3c 35 74 68 65 6e 65 78 69 74 66 75 6e 63 74 69 6f 6e 64 69 6d 69 61 73 6c 6f 6e 67 66 6f 72 69 3d 31 74 6f 76 62 61 2e 6c 65 6e 62 28 73 72 63 29 2d 35 69 66 28 73 72 63 28 69 29 3d 26 68 34 64 29 61 6e 64 28 73 72 63 28 69 2b 31 29 3d 26 68 35 61 29 61 6e 64 28 73 72 63 28 69 2b 32 29 3d 26 68 39 30 29 74 68 65 6e } //1 src)<5thenexitfunctiondimiaslongfori=1tovba.lenb(src)-5if(src(i)=&h4d)and(src(i+1)=&h5a)and(src(i+2)=&h90)then
		$a_01_2 = {64 69 6d 72 61 73 6c 6f 6e 67 72 3d 63 70 28 30 26 2c 73 74 72 70 74 72 28 76 62 61 2e 73 74 72 72 65 76 65 72 73 65 28 65 78 65 63 29 29 2c 30 26 2c 30 26 2c 74 72 75 65 2c 30 26 2c 62 79 76 61 6c 30 26 2c 73 74 72 70 74 72 28 77 64 29 2c 74 73 69 2c 74 73 61 5f 70 69 29 77 66 73 6f 74 73 61 5f 70 69 2e 68 70 2c 31 37 30 30 30 } //1 dimraslongr=cp(0&,strptr(vba.strreverse(exec)),0&,0&,true,0&,byval0&,strptr(wd),tsi,tsa_pi)wfsotsa_pi.hp,17000
		$a_01_3 = {73 72 77 63 72 66 6c 64 70 66 6f 26 22 5c 22 26 70 66 6f 31 66 73 6f 2e 63 6f 70 79 66 69 6c 65 74 68 69 73 77 6f 72 6b 62 6f 6f 6b 2e 70 61 74 68 26 22 5c 22 26 74 68 69 73 77 6f 72 6b 62 6f 6f 6b 2e 6e 61 6d 65 2c 74 66 26 22 5c 22 26 6f 62 6a 74 30 66 73 6f 2e 63 6f 70 79 66 69 6c 65 74 66 26 22 5c 22 26 74 6d 70 64 2c 64 66 6f 26 22 5c 22 26 70 72 6f 74 26 22 5c 22 26 64 6e 61 75 74 68 69 73 77 6f 72 6b 62 6f 6f 6b 2e 70 72 6f 74 65 63 74 70 73 } //1 srwcrfldpfo&"\"&pfo1fso.copyfilethisworkbook.path&"\"&thisworkbook.name,tf&"\"&objt0fso.copyfiletf&"\"&tmpd,dfo&"\"&prot&"\"&dnauthisworkbook.protectps
	condition:
		((#a_01_0  & 1)*1+(#a_01_1  & 1)*1+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1) >=4
 
}