
rule Ransom_Win64_LockFile_NIT_MTB{
	meta:
		description = "Ransom:Win64/LockFile.NIT!MTB,SIGNATURE_TYPE_PEHSTR_EXT,03 00 03 00 02 00 00 "
		
	strings :
		$a_03_0 = {89 5c 24 30 48 8d 4d fc 48 89 4c 24 28 48 89 54 24 20 41 b9 00 00 00 00 41 b8 01 00 00 00 ba 00 00 00 00 48 89 c1 48 8b 05 11 ?? 13 00 ff d0 85 c0 0f 94 c0 84 c0 } //2
		$a_03_1 = {c7 44 24 60 01 00 10 00 ff 15 6e ?? 11 00 31 d2 48 8b 4e 28 ff 15 aa ?? 11 00 3d 02 01 00 00 0f 85 f4 fe ff ff 48 8b 4e 28 48 8d 54 24 30 ff 15 40 ?? 11 00 48 8d 05 81 fa ff ff 48 8b 4e 28 48 8d 54 24 30 48 89 84 24 28 01 00 00 ff 15 0a ?? 11 00 0f b6 46 40 83 66 44 fe 83 e0 f0 83 c8 05 88 46 40 f0 83 05 c1 0e 11 00 01 48 8b 4e 30 48 85 c9 74 06 ff 15 ba ?? 11 00 48 8d 4e 38 e8 49 d6 ff ff 48 8b 4e 28 ff 15 77 ?? 11 00 e9 87 fe ff ff } //1
	condition:
		((#a_03_0  & 1)*2+(#a_03_1  & 1)*1) >=3
 
}
rule Ransom_Win64_LockFile_NIT_MTB_2{
	meta:
		description = "Ransom:Win64/LockFile.NIT!MTB,SIGNATURE_TYPE_PEHSTR_EXT,16 00 16 00 09 00 00 "
		
	strings :
		$a_03_0 = {4c 8d 25 7f ?? 00 00 4c 89 a4 24 b0 03 00 00 48 8d 05 88 ?? 00 00 48 89 84 24 b8 03 00 00 48 89 bc 24 c0 03 00 00 33 d2 b9 02 00 00 00 ff 15 cb ?? 00 00 4c 8b f0 c7 84 24 70 01 00 00 ?? ?? 00 00 33 d2 41 b8 34 02 00 00 48 8d 8c 24 74 01 00 00 e8 60 8c 00 00 48 8d 94 24 70 01 00 00 49 8b ce ff 15 1f ?? 00 00 85 c0 } //2
		$a_01_1 = {76 73 73 61 64 6d 69 6e 20 64 65 6c 65 74 65 20 73 68 61 64 6f 77 73 20 2f 61 6c 6c 20 2f 71 75 69 65 74 } //2 vssadmin delete shadows /all /quiet
		$a_01_2 = {62 63 64 65 64 69 74 20 2f 73 65 74 20 7b 64 65 66 61 75 6c 74 7d 20 72 65 63 6f 76 65 72 79 65 6e 61 62 6c 65 64 20 4e 6f } //2 bcdedit /set {default} recoveryenabled No
		$a_01_3 = {6e 65 74 20 73 74 6f 70 20 57 69 6e 44 65 66 65 6e 64 } //2 net stop WinDefend
		$a_01_4 = {6e 65 74 73 68 20 61 64 76 66 69 72 65 77 61 6c 6c 20 73 65 74 20 61 6c 6c 70 72 6f 66 69 6c 65 73 20 73 74 61 74 65 20 6f 66 66 } //2 netsh advfirewall set allprofiles state off
		$a_01_5 = {41 6c 6c 20 66 69 6c 65 73 20 6f 6e 20 64 72 69 76 65 73 } //5 All files on drives
		$a_01_6 = {61 72 65 20 45 4e 43 52 59 50 54 45 44 } //5 are ENCRYPTED
		$a_01_7 = {42 69 74 63 6f 69 6e } //2 Bitcoin
		$a_01_8 = {64 65 63 72 79 70 74 20 79 6f 75 72 20 66 69 6c 65 73 } //2 decrypt your files
	condition:
		((#a_03_0  & 1)*2+(#a_01_1  & 1)*2+(#a_01_2  & 1)*2+(#a_01_3  & 1)*2+(#a_01_4  & 1)*2+(#a_01_5  & 1)*5+(#a_01_6  & 1)*5+(#a_01_7  & 1)*2+(#a_01_8  & 1)*2) >=22
 
}