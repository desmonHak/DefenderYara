
rule Trojan_Win32_Alien_AHB_MTB{
	meta:
		description = "Trojan:Win32/Alien.AHB!MTB,SIGNATURE_TYPE_PEHSTR_EXT,64 00 64 00 05 00 00 "
		
	strings :
		$a_01_0 = {43 72 65 61 74 65 20 70 65 72 73 69 73 74 65 6e 74 20 73 63 68 65 64 75 6c 65 64 20 74 61 73 6b } //10 Create persistent scheduled task
		$a_01_1 = {47 65 74 20 47 69 74 48 75 62 20 55 52 4c 20 66 72 6f 6d 20 50 61 73 74 65 62 69 6e } //10 Get GitHub URL from Pastebin
		$a_01_2 = {45 78 65 63 75 74 65 20 61 73 20 62 61 63 6b 67 72 6f 75 6e 64 20 70 72 6f 63 65 73 73 } //10 Execute as background process
		$a_01_3 = {66 75 6e 63 74 69 6f 6e 20 44 6f 77 6e 6c 6f 61 64 2d 46 69 6c 65 57 69 74 68 52 65 74 72 69 65 73 } //20 function Download-FileWithRetries
		$a_01_4 = {24 67 69 74 68 75 62 55 72 6c 20 3d 20 28 49 6e 76 6f 6b 65 2d 57 65 62 52 65 71 75 65 73 74 20 2d 55 72 69 20 24 70 61 73 74 65 62 69 6e 55 72 6c 20 2d 55 73 65 42 61 73 69 63 50 61 72 73 69 6e 67 20 2d 45 72 72 6f 72 41 63 74 69 6f 6e 20 53 74 6f 70 29 2e 43 6f 6e 74 65 6e 74 2e 54 72 69 6d 28 29 } //50 $githubUrl = (Invoke-WebRequest -Uri $pastebinUrl -UseBasicParsing -ErrorAction Stop).Content.Trim()
	condition:
		((#a_01_0  & 1)*10+(#a_01_1  & 1)*10+(#a_01_2  & 1)*10+(#a_01_3  & 1)*20+(#a_01_4  & 1)*50) >=100
 
}