
rule Trojan_Win32_DeathStalker_A{
	meta:
		description = "Trojan:Win32/DeathStalker.A,SIGNATURE_TYPE_CMDHSTR_EXT,03 00 03 00 04 00 00 "
		
	strings :
		$a_80_0 = {76 73 73 61 64 6d 69 6e 2e 65 78 65 20 } //vssadmin.exe   1
		$a_80_1 = {6c 69 73 74 20 } //list   1
		$a_80_2 = {73 68 61 64 6f 77 73 } //shadows  1
		$a_00_3 = {39 00 34 00 35 00 33 00 65 00 38 00 38 00 31 00 2d 00 32 00 36 00 61 00 38 00 2d 00 34 00 39 00 37 00 33 00 2d 00 62 00 61 00 32 00 65 00 2d 00 37 00 36 00 32 00 36 00 39 00 65 00 39 00 30 00 31 00 64 00 30 00 65 00 } //-1 9453e881-26a8-4973-ba2e-76269e901d0e
	condition:
		((#a_80_0  & 1)*1+(#a_80_1  & 1)*1+(#a_80_2  & 1)*1+(#a_00_3  & 1)*-1) >=3
 
}
rule Trojan_Win32_DeathStalker_A_2{
	meta:
		description = "Trojan:Win32/DeathStalker.A,SIGNATURE_TYPE_CMDHSTR_EXT,04 00 04 00 05 00 00 "
		
	strings :
		$a_80_0 = {6d 73 78 73 6c 2e 65 78 65 20 } //msxsl.exe   1
		$a_80_1 = {70 61 79 6c 6f 61 64 2e 78 6d 6c } //payload.xml  1
		$a_80_2 = {70 61 79 6c 6f 61 64 2e 78 73 6c } //payload.xsl  1
		$a_80_3 = {41 70 70 44 61 74 61 5c 4c 6f 63 61 6c 5c 54 65 6d 70 } //AppData\Local\Temp  1
		$a_00_4 = {39 00 34 00 35 00 33 00 65 00 38 00 38 00 31 00 2d 00 32 00 36 00 61 00 38 00 2d 00 34 00 39 00 37 00 33 00 2d 00 62 00 61 00 32 00 65 00 2d 00 37 00 36 00 32 00 36 00 39 00 65 00 39 00 30 00 31 00 64 00 30 00 64 00 } //-1 9453e881-26a8-4973-ba2e-76269e901d0d
	condition:
		((#a_80_0  & 1)*1+(#a_80_1  & 1)*1+(#a_80_2  & 1)*1+(#a_80_3  & 1)*1+(#a_00_4  & 1)*-1) >=4
 
}