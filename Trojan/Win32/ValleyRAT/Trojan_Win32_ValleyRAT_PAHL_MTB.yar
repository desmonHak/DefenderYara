
rule Trojan_Win32_ValleyRAT_PAHL_MTB{
	meta:
		description = "Trojan:Win32/ValleyRAT.PAHL!MTB,SIGNATURE_TYPE_PEHSTR_EXT,08 00 08 00 06 00 00 "
		
	strings :
		$a_01_0 = {6d 6f 6e 69 74 6f 72 2e 62 61 74 } //2 monitor.bat
		$a_01_1 = {74 61 73 6b 6c 69 73 74 20 2f 46 49 20 22 49 4d 41 47 45 4e 41 4d 45 20 65 71 20 25 50 72 6f 63 65 73 73 4e 61 6d 65 25 22 20 7c 20 66 69 6e 64 73 74 72 20 2f 49 20 22 25 50 72 6f 63 65 73 73 4e 61 6d 65 25 22 20 3e 6e 75 6c } //2 tasklist /FI "IMAGENAME eq %ProcessName%" | findstr /I "%ProcessName%" >nul
		$a_01_2 = {63 6d 64 2e 65 78 65 20 2f 42 20 2f 63 20 22 25 73 22 } //1 cmd.exe /B /c "%s"
		$a_01_3 = {6d 6f 6e 69 74 6f 72 2e 70 69 64 } //1 monitor.pid
		$a_01_4 = {63 6f 70 79 20 2f 59 20 22 25 42 61 63 6b 75 70 50 72 6f 63 65 73 73 50 61 74 68 25 22 20 22 25 50 72 6f 63 65 73 73 50 61 74 68 25 22 } //1 copy /Y "%BackupProcessPath%" "%ProcessPath%"
		$a_01_5 = {49 4e 56 41 4c 49 44 2e 61 70 73 } //1 INVALID.aps
	condition:
		((#a_01_0  & 1)*2+(#a_01_1  & 1)*2+(#a_01_2  & 1)*1+(#a_01_3  & 1)*1+(#a_01_4  & 1)*1+(#a_01_5  & 1)*1) >=8
 
}