
rule Trojan_Win32_Powdow_SX_MTB{
	meta:
		description = "Trojan:Win32/Powdow.SX!MTB,SIGNATURE_TYPE_PEHSTR_EXT,20 00 20 00 08 00 00 "
		
	strings :
		$a_01_0 = {53 74 61 72 74 2d 50 72 6f 63 65 73 73 20 2d 46 69 6c 65 50 61 74 68 20 22 70 6f 77 65 72 73 68 65 6c 6c 2e 65 78 65 22 20 2d 41 72 67 75 6d 65 6e 74 4c 69 73 74 20 22 2d 45 6e 63 6f 64 65 64 43 6f 6d 6d 61 6e 64 22 2c 20 22 56 77 42 79 41 47 6b 41 64 41 42 6c 41 43 30 41 53 41 42 76 41 47 30 2e 2e 2e 22 20 2d 57 61 69 74 } //20 Start-Process -FilePath "powershell.exe" -ArgumentList "-EncodedCommand", "VwByAGkAdABlAC0ASABvAG0..." -Wait
		$a_80_1 = {41 4d 51 41 76 41 48 49 41 5a 51 42 6d 41 48 4d 41 4c 77 42 6f 41 47 55 41 59 51 42 6b 41 48 4d 41 4c 77 42 74 41 47 45 41 61 51 42 75 41 43 38 41 64 41 42 6c 41 48 4d 41 64 41 41 75 41 48 41 41 63 77 41 78 41 43 49 41 49 41 41 74 41 45 38 41 64 51 42 30 41 45 59 41 61 51 42 73 41 47 55 41 49 41 41 6b 41 47 63 41 61 51 42 6d 41 48 41 41 59 51 42 30 41 47 67 41 } //AMQAvAHIAZQBmAHMALwBoAGUAYQBkAHMALwBtAGEAaQBuAC8AdABlAHMAdAAuAHAAcwAxACIAIAAtAE8AdQB0AEYAaQBsAGUAIAAkAGcAaQBmAHAAYQB0AGgA  20
		$a_01_2 = {53 74 61 72 74 2d 50 72 6f 63 65 73 73 20 2d 46 69 6c 65 50 61 74 68 20 22 70 6f 77 65 72 73 68 65 6c 6c 2e 65 78 65 22 20 2d 41 72 67 75 6d 65 6e 74 4c 69 73 74 20 22 2d 43 6f 6d 6d 61 6e 64 22 2c 20 22 52 65 6d 6f 76 65 2d 49 74 65 6d 20 2d 50 61 74 68 20 27 24 53 63 72 69 70 74 4c 6f 63 61 74 69 6f 6e 5c 74 65 73 74 31 2e 65 78 65 27 22 } //10 Start-Process -FilePath "powershell.exe" -ArgumentList "-Command", "Remove-Item -Path '$ScriptLocation\test1.exe'"
		$a_01_3 = {24 6d 61 6c 77 3d 27 53 74 61 72 74 2d 50 72 6f 63 65 73 73 20 2d 46 69 6c 65 50 61 74 68 20 22 70 6f 77 65 72 73 68 65 6c 6c 2e 65 78 65 22 2d 41 72 67 75 6d 65 6e 74 4c 69 73 74 20 22 2e 5c 74 65 73 74 32 35 36 2e 70 73 31 22 20 2d 77 61 69 74 27 } //10 $malw='Start-Process -FilePath "powershell.exe"-ArgumentList ".\test256.ps1" -wait'
		$a_80_4 = {52 65 6d 6f 76 65 2d 49 74 65 6d 20 2d 50 61 74 68 20 27 24 53 63 72 69 70 74 4c 6f 63 61 74 69 6f 6e 5c 74 65 73 74 31 2e 65 78 65 27 } //Remove-Item -Path '$ScriptLocation\test1.exe'  1
		$a_80_5 = {24 67 69 66 70 61 74 68 20 3d 20 24 70 77 64 2e 50 61 74 68 2b 27 5c 73 76 63 68 6f 73 74 2e 65 78 65 27 } //$gifpath = $pwd.Path+'\svchost.exe'  1
		$a_80_6 = {57 72 69 74 65 2d 48 6f 73 74 20 22 73 65 6e 64 20 74 6f 20 31 38 6f 38 65 4b 72 38 53 6e 33 45 42 70 47 6a 4e 6d 58 56 34 58 64 70 45 4d 35 48 63 31 46 7a 74 65 22 } //Write-Host "send to 18o8eKr8Sn3EBpGjNmXV4XdpEM5Hc1Fzte"  1
		$a_80_7 = {53 6f 66 74 77 61 72 65 5c 4d 69 63 72 6f 73 6f 66 74 5c 57 69 6e 64 6f 77 73 5c 43 75 72 72 65 6e 74 56 65 72 73 69 6f 6e 5c 52 75 6e } //Software\Microsoft\Windows\CurrentVersion\Run  1
	condition:
		((#a_01_0  & 1)*20+(#a_80_1  & 1)*20+(#a_01_2  & 1)*10+(#a_01_3  & 1)*10+(#a_80_4  & 1)*1+(#a_80_5  & 1)*1+(#a_80_6  & 1)*1+(#a_80_7  & 1)*1) >=32
 
}